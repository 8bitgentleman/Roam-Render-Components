[{"create-time":1653048188375,"title":"roam/render",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"edit-time":1653048230082,"children":[{"string":"**Author**","create-time":1653048235156,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"Me, [[Matt Vogel]]","create-time":1653048245395,":block/refs":[{":block/uid":"IDmsNojEw"}],"refs":[{"uid":"IDmsNojEw"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"GdLn_JnMQ","edit-time":1653048246796,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"Twitter:: [@todayIwasbetter](https://twitter.com/todayIwasbetter)","create-time":1653048250044,":block/refs":[{":block/uid":"D86Ql7i-2"}],"refs":[{"uid":"D86Ql7i-2"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"fH0rnYJBk","edit-time":1653048251020,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"How Best To Contact Me:: Roam Slack, Twitter are good","create-time":1653048255601,":block/refs":[{":block/uid":"-addtDlmH"}],"refs":[{"uid":"-addtDlmH"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"9iMQw_g2K","edit-time":1653048256559,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"This code is open source! If you have ideas for improvements or run into a bug feel free to fork it or report it over on the [Github repo](https://github.com/8bitgentleman/Roam-Render-Components)","uid":"3PK3Uzh6J","create-time":1653048261132,"edit-time":1653048261375,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"J_pQo4zYr","edit-time":1653048241429,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"edit-time":1653048428903,"children":[{"string":"{{[[roam/render]]:((KgZGnfMTi))}}","create-time":1645898804661,":block/refs":[{":block/uid":"k8x331LcF"},{":block/uid":"KgZGnfMTi"}],"refs":[{"uid":"k8x331LcF"},{"uid":"KgZGnfMTi"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"qBgS6vL6A","edit-time":1653048421558,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"refs":[{"uid":"jVVAczsWy"}],"uid":"QqCrBRJCv",":block/refs":[{":block/uid":"jVVAczsWy"}],"string":"Roam Highlight Component v6 [[roam/templates]]",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"create-time":1645898804661,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"code","create-time":1645898804661,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"```clojure\n(ns quote-card-v6\n  (:require\n   [reagent.core :as r]\n   [datascript.core :as d]\n   [roam.datascript.reactive :as dr]\n   [clojure.pprint :as pp]\n   [clojure.string :as string]\n   [roam.util :as u]\n   [roam.block :as block]\n   ))\n\n(def app-data\n  ;; dummy data to display when the component is initialized\n     (r/atom {:book \"Book/How to Take Smart Notes\" \n              :author \"SÃ¶nke Ahrens\"\n              :highlight \"There is no point in having great tools if they don't fit together \"\n              :chapter \"Good Solutions are Simple\"\n              :cover \"https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FTest_onboard%2Fp7LKsdZRNR.jpg?alt=media&token=4e91252b-a694-485d-a065-4d09ccb2ca48\"\n              :uid \"XqNLVenef\"\n              :parent \"\"}))\n\n\n(def results\n  ;; query to find all highlights\n    @(dr/q '[:find (pull ?c [:block/string\n                             :block/uid\n                             :block/heading\n                             {:block/children ...}]) \n              :where \n                [?refs :block/refs ?title]\n                [?title :node/title \"quotes\"]\n                [?refs :block/children ?c]])\n    )\n\n(defn getPageTitleByBlockUid [block-uid]\n  @(dr/q '[:find (pull ?p [:node/title]) .\n               :in $ ?uid\n               :where\n                      [?e :block/uid ?uid]\n                      [?e :block/page ?p]]\n          block-uid)\n  )\n\n(defn strToPage [string ]\n  ;; converts the name of a page into a roam page markdown\n  (+ \"[[\" string \"]]\")\n  )\n\n(defn strToRef [string ]\n  ;; converts a roam UID string into a block ref \n  (+ \"((\" string \"))\")\n  )\n\n(defn getBookTitle \n  [uid]\n  (-> uid\n   getPageTitleByBlockUid\n\t(get :node/title)\n    ))\n\n(defn getBookCover [page]\n  (or (:block/string @(dr/q '[:find (pull ?c [:block/string\n                     :block/uid\n                     {:block/children ...}]) .\n         \t:in $ ?book\n            :where\n                [?p :node/title ?book]\n                [?b :block/page ?p]\n                [?b :block/uid ?u]\n                [?b :block/string ?s]\n                [(clojure.string/includes? ?s  \"Cover::\")]\n                [?b :block/children ?c]\n                ]\n          page))\n      \"![](https://readwise-assets.s3.amazonaws.com/static/images/default-book-icon-4.11327a2af05a.png)\")\n  )\n\n(defn getAuthorWriters [page]\n  (string/split\n    (or (or (:block/string @(dr/q '[:find (pull ?b [:block/string]) .\n           \t:in $ ?book\n              :where\n                  [?p :node/title ?book]\n                  [?b :block/page ?p]\n                  [?b :block/uid ?u]\n                  [?b :block/string ?s]\n                  [(clojure.string/includes? ?s  \"Author::\")]\n                  ]\n            page))\n        (:block/string @(dr/q '[:find (pull ?b [:block/string]) .\n           \t:in $ ?book\n              :where\n                  [?p :node/title ?book]\n                  [?b :block/page ?p]\n                  [?b :block/uid ?u]\n                  [?b :block/string ?s]\n                  [(clojure.string/includes? ?s  \"Writers::\")]\n                  ]\n            page)))\n        \"Author::\")\n   \"::\")\n  )\n\n(defn flattenBookCoverUrl \n  ;; gets the book cover url from the block string\n  [page]\n  (->> page\n   getBookCover\n    (re-matches #\"!\\[.*\\]\\((.+)\\)\" )\n    last\n    ))\n\n(defn flatten-block \n  ;; Flattens blocks children into a flat list. \n  ;; Could be moved into the datalog query in the future\n  [acc block]\n  (reduce flatten-block\n          (conj acc (dissoc block :block/children))\n          (:block/children block)))\n\n(defn filter-heading\n  ;; removes h1, h2, h3 blocks from a collection\n  [ks coll]\n  (filter #(false? (contains? % ks)) coll))\n\n(defn filter-attributes [filterstring coll]\n  ;; removed attribute blocks from a collection\n  (filter #(false? (string/includes? \n            (:block/string %)\n            (str filterstring)))\n         coll)\n          )\n\n(defn filter-blocks [coll]\n  ;; filters out unwanted blocks including chapter headers and block attributes. \n  ;; This will be moved into the datalog query in the future\n  (->> coll\n    (filter-heading :block/heading )\n    \n    (filter-attributes \"::\")\n    )\n  )\n\n(defn media-context[]\n  ;; wrapper for the metadata of the highlgiht (author, chapter, tags, book cover, etc)\n   [:div.media {:style{:display: \"flex\"}}\n    [:img\n     {:style {:height \"66px\"\n              :position \"relative\"\n              :float \"left\"\n              :margin-right \"10px\"},\n      :src (:cover @app-data)}]\n    [:div\n      [:div.is-flex\n       [:span.highlight-title {:style{\n                              :font-weight \"700\"\n                              :display: \"inline\"\n                              :color \"#1f1f1f\"\n                              :word-break \"break-word\"}}\n        (u/parse (strToPage (:book @app-data) ))]]\n     [:p.highlight-author \n      {:style{:color \"#6b7888\"}}\n      (:author @app-data)]\n     [:div.highlight-sections \n      {:style{:color \"#4a4a4a\"}}\n      (:chapter @app-data)]\n     ]]\n\n  )\n\n(defn card []\n  [:div \n    [:div {:class \"bp3-card bp3-elevation-2\" \n           :style{ :overflow \"hidden\"}}    \n     [media-context]\n     [:p {:style{:font-size \"1.25em\"}}(u/parse (strToRef (:uid @app-data) )) ]\n     ]\n   ]\n)\n\n(defn get-highlight []\n  (let [*quote (rand-nth(filter-blocks (flatten (map #(flatten-block [] % )(flatten results)))))] \n    (.log js/console *quote)\n    \n    (swap! app-data assoc-in [:cover] (flattenBookCoverUrl (getBookTitle (:block/uid *quote))))\n    (swap! app-data assoc-in [:highlight] (:block/string *quote))\n    (swap! app-data assoc-in [:uid] (:block/uid *quote))\n    (swap! app-data assoc-in [:book] (getBookTitle (:block/uid *quote)))\n    (swap! app-data assoc-in [:author] (getAuthorWriters (getBookTitle (:block/uid *quote))) )\n    \n    ))\n\n(defn save-highlight []\n ;; exports the block ref of the current quote below the component\n  (block/create \n          {:location {:parent-uid (:parent @app-data)\n                      :order 0}\n           :block {:string (strToRef (:uid @app-data) )}}\n   )\n  )\n\n(defn footer-button [text icon click-fn]\n  \"button\"\n  [:span {:class text}\n   [:button {:class (+ \"bp3-button\n                     \t\tbp3-small\n                     \t\tbp3-outlined\n                     \t\tbp3-icon-\" icon)\n                    :draggable false\n                    :style {:margin \"10px 5px\"\n                            }\n                    :on-click (fn [e](click-fn))}\n           text]])\n\n(defn main [{:keys [block-uid]} & args]\n  ;;this is a dumb hack to avoid save-highlight triggering when args are passed\n  (swap! app-data assoc-in [:parent] block-uid)\n  \t[:body.rm-highlight-component\n      [:div.rm-highlight-card {:class \"bp3-card bp3-elevation-2\" \n             :style{:max-width \"500px\" \n                    :background-color \"rgb(244,243,243)\" \n                    :padding \"0px\"\n                    }}\n       [card (:book @app-data) (:highlight @app-data)]\n       [footer-button \"save\" \"export\" save-highlight  ]\n       [footer-button \"another\" \"refresh\" get-highlight]\n\n     ]]\n  )\n\n```","uid":"KgZGnfMTi","create-time":1645898804661,"edit-time":1653048461965,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"4KQjx2foE","edit-time":1653048421558,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"CSS (examples, don't actually use these colors)","create-time":1653048288741,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"Move codeblock to [[roam/css]]","create-time":1653048340828,":block/refs":[{":block/uid":"v4kxDU_uw"}],"refs":[{"uid":"v4kxDU_uw"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"N_rGXt9cz","edit-time":1653048341789,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"```css\n/* This is all example CSS for targeting different parts of the component. Don't actually use these colors unless you hate yourself */\n\n.rm-highlight-component{\n    background-color:transparent;\n  }\n  .rm-highlight-component .rm-highlight-card{\n    background-color:blue !important;\n    color:orange !important;\n  }\n  .rm-highlight-card .bp3-card{\n    background-color:lightgreen;\n    color:yellow;\n    \n  }\n  /*chapter title*/\n  .rm-highlight-card .highlight-sections{\n    color: salmon !important;\n  }\n  /*author*/\n  .rm-highlight-card .highlight-author{\n    color: purple !important;\n  \n  }\n  \n  /*button color*/\n  .rm-highlight-card button{\n    color:red !important;\n    background:green !important;\n  }\n  /*button icon color*/\n  .rm-highlight-card button::before{\n    color:red !important;\n  }\n  /*button on hover*/\n  .rm-highlight-card button:hover{\n    color:blue !important;\n    background:orange !important;\n  }\n  ```","uid":"ihhfBZbxx","create-time":1653048322615,"edit-time":1653048333106,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"rDI07cs3o","edit-time":1653048322173,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"refs":[{"uid":"02-26-2022"}],"uid":"gWAcjGgeF",":block/refs":[{":block/uid":"02-26-2022"}],"string":"WIP Roam Highlight Compoent v6 - [[February 26th, 2022]]",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"create-time":1653048211328,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"k8x331LcF","edit-time":1653048188375,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}]