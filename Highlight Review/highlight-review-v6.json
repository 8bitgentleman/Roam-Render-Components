[{"create-time":1629371007672,"title":"roam/render",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"edit-time":1645898654319,"children":[{"string":"**Author**","create-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"Me, [[Matt Vogel]]","create-time":1645898467894,":block/refs":[{":block/uid":"0Rcdlx-xW"}],"refs":[{"uid":"0Rcdlx-xW"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"DwGkHDcPv","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"Twitter:: [@todayIwasbetter](https://twitter.com/todayIwasbetter)","create-time":1645898467894,":block/refs":[{":block/uid":"A_V6-tfMu"}],"refs":[{"uid":"A_V6-tfMu"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"jBt8Lyewo","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"How Best To Contact Me:: Twitter is best, Roam Slack is also good","create-time":1645898467894,":block/refs":[{":block/uid":"US1dWUALf"}],"refs":[{"uid":"US1dWUALf"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"D6DOOV-8F","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"This code is open source! If you have ideas for improvements or run into a bug feel free to fork it or report it over on the [Github repo](https://github.com/8bitgentleman/Roam-Render-Components)","uid":"erGfDV42d","create-time":1645898467894,"edit-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"DlbxjgYEf","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"**About Component**","create-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"This is a WIP component which creates a custom UI where highlights/quotes in your graph can be reviewed. ","uid":"zgESw5Y9v","create-time":1645904156720,"edit-time":1645904769704,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"For this extension to work highlights must be nested under a specific tag/page/attribute `quotes`.  It's currently extremely picky about the format and metadata that your pages have. My personal template can be seen below but any block nested under `#quotes` __should__ be seen by the component","create-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"![](https://raw.githubusercontent.com/8bitgentleman/Roam-Render-Components/main/Highlight%20Review/note-format.png)","props":{"image-size":{"https://raw.githubusercontent.com/8bitgentleman/Roam-Render-Components/main/Highlight%20Review/note-format.png":{"width":204,"height":null}}},"create-time":1645904320503,":block/props":{":image-size":{"https://raw.githubusercontent.com/8bitgentleman/Roam-Render-Components/main/Highlight%20Review/note-format.png":{":width":204,":height":null}}},":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"oTyZAyx5V","edit-time":1645904327378,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"7sO99aZk4","edit-time":1645904791532,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"px6yNmXrF","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"edit-time":1645903768327,"children":[{"string":"{{[[roam/render]]:((KgZGnfMTi))}}","create-time":1645898804661,":block/refs":[{":block/uid":"VK3JN0EgW"},{":block/uid":"KgZGnfMTi"}],"refs":[{"uid":"VK3JN0EgW"},{"uid":"KgZGnfMTi"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"qBgS6vL6A","edit-time":1645903955218,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"refs":[{"uid":"ijFx9XSFA"}],"uid":"QqCrBRJCv",":block/refs":[{":block/uid":"ijFx9XSFA"}],"string":"Highlight Review v6 [[roam/templates]]",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"create-time":1645898804661,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"code","create-time":1645898804661,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"```clojure\n(ns quote-card-v6\n  (:require\n   [reagent.core :as r]\n   [datascript.core :as d]\n   [roam.datascript.reactive :as dr]\n   [clojure.pprint :as pp]\n   [clojure.string :as string]\n   [roam.util :as u]\n   [roam.block :as block]\n   ))```","uid":"jdTWkjEpy","create-time":1645898804661,"edit-time":1645903755968,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"```clojure\n\n(def app-data\n     (r/atom {:book \"Book/How to Take Smart Notes\" \n              :author \"SÃ¶nke Ahrens\"\n              :highlight \"There is no point in having great tools if they don't fit together \"\n              :chapter \"\"\n              :cover \"https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FTest_onboard%2Fp7LKsdZRNR.jpg?alt=media&token=4e91252b-a694-485d-a065-4d09ccb2ca48\"\n              :uid \"XqNLVenef\"\n              :parent \"\"}))```","uid":"k37aze1Zf","create-time":1645898804661,"edit-time":1645905397746,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"```clojure\n\n(def results\n    @(dr/q '[:find (pull ?c [:block/string\n                             :block/uid\n                             :block/heading\n                             {:block/children ...}]) \n              :where \n                [?refs :block/refs ?title]\n                [?title :node/title \"quotes\"]\n                [?refs :block/children ?c]])\n    )\n(defn getPageTitleByBlockUid [block-uid]\n  @(dr/q '[:find (pull ?p [:node/title]) .\n               :in $ ?uid\n               :where\n                      [?e :block/uid ?uid]\n                      [?e :block/page ?p]]\n          block-uid)\n  )\n(defn strToPage [string ]\n  (+ \"[[\" string \"]]\")\n  )\n(defn strToRef [string ]\n  (+ \"((\" string \"))\")\n  )\n(defn getBookTitle \n  [uid]\n  (-> uid\n   getPageTitleByBlockUid\n\t(get :node/title)\n    ))\n\n(defn getBookCover [page]\n  (or (:block/string @(dr/q '[:find (pull ?c [:block/string\n                     :block/uid\n                     {:block/children ...}]) .\n         \t:in $ ?book\n            :where\n                [?p :node/title ?book]\n                [?b :block/page ?p]\n                [?b :block/uid ?u]\n                [?b :block/string ?s]\n                [(clojure.string/includes? ?s  \"Cover::\")]\n                [?b :block/children ?c]\n                ]\n          page))\n      \"![](https://readwise-assets.s3.amazonaws.com/static/images/default-book-icon-4.11327a2af05a.png)\")\n  )\n(defn getAuthorWriters [page]\n  (string/split\n    (or (or (:block/string @(dr/q '[:find (pull ?b [:block/string]) .\n           \t:in $ ?book\n              :where\n                  [?p :node/title ?book]\n                  [?b :block/page ?p]\n                  [?b :block/uid ?u]\n                  [?b :block/string ?s]\n                  [(clojure.string/includes? ?s  \"Author::\")]\n                  ]\n            page))\n        (:block/string @(dr/q '[:find (pull ?b [:block/string]) .\n           \t:in $ ?book\n              :where\n                  [?p :node/title ?book]\n                  [?b :block/page ?p]\n                  [?b :block/uid ?u]\n                  [?b :block/string ?s]\n                  [(clojure.string/includes? ?s  \"Writers::\")]\n                  ]\n            page)))\n        \"Author::\")\n   \"::\")\n  )\n\n(defn flattenBookCoverUrl \n  [page]\n  (->> page\n   getBookCover\n    (re-matches #\"!\\[.*\\]\\((.+)\\)\" )\n    last\n    ))\n\n(defn flatten-block \n  \"Flattens blocks children into a flat list\"\n  [acc block]\n  (reduce flatten-block\n          (conj acc (dissoc block :block/children))\n          (:block/children block)))\n\n(defn filter-heading\n  [ks coll]\n  (filter #(false? (contains? % ks)) coll))\n\n(defn filter-attributes [filterstring coll]\n  (filter #(false? (string/includes? \n            (:block/string %)\n            (str filterstring)))\n         coll)\n          )\n\n(defn filter-blocks [coll]\n  (->> coll\n    (filter-heading :block/heading )\n    \n    (filter-attributes \"::\")\n    )\n  )\n```","uid":"NEm3nAeqd","create-time":1645898804661,"edit-time":1645905265818,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"```clojure\n(defn media-context[]\n   [:div.media {:style{:display: \"flex\"}}\n    [:img\n     {:style {:height \"66px\"\n              :position \"relative\"\n              :float \"left\"\n              :margin-right \"10px\"},\n      :src (:cover @app-data)}]\n    [:div\n      [:div.is-flex\n       [:span.highlight-title {:style{\n                                    :font-weight \"700\"\n    \t\t\t\t\t\t\t\t:display: \"inline\"\n\t\t\t\t\t\t\t\t    :color \"#1f1f1f\"\n                                    :word-break \"break-word\"}}\n        (u/parse (strToPage (:book @app-data) ))]]\n     [:div.highlight-sections \n      {:style{:color \"#4a4a4a\"}}\n      (:chapter @app-data)]\n     [:p.highlight-author \n      {:style{:color \"#6b7888\"}}\n      (:author @app-data)]]]\n\n  )```","uid":"W4_WPc7jW","create-time":1645898804661,"edit-time":1645903755968,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"```clojure\n(defn card []\n  [:div \n    [:div {:class \"bp3-card bp3-elevation-2\" \n           :style{ :overflow \"hidden\"}}    \n     [media-context]\n     [:p {:style{:font-size \"1.25em\"}}(u/parse (strToRef (:uid @app-data) )) ]\n     ]\n   ]\n)\n(defn get-highlight []\n  (let [*quote (rand-nth(filter-blocks (flatten (map #(flatten-block [] % )(flatten results)))))] \n    (.log js/console *quote)\n    \n    (swap! app-data assoc-in [:cover] (flattenBookCoverUrl (getBookTitle (:block/uid *quote))))\n    (swap! app-data assoc-in [:highlight] (:block/string *quote))\n    (swap! app-data assoc-in [:uid] (:block/uid *quote))\n    (swap! app-data assoc-in [:book] (getBookTitle (:block/uid *quote)))\n    (swap! app-data assoc-in [:author] (getAuthorWriters (getBookTitle (:block/uid *quote))) )\n    \n    ))\n\n(defn save-highlight []\n ;; (.log js/console parent-block)\n  (block/create \n          {:location {:parent-uid (:parent @app-data)\n                      :order 0}\n           :block {:string (strToRef (:uid @app-data) )}}\n   )\n  )\n\n(defn footer-button [text icon click-fn]\n  \"button\"\n  [:span {:class text}\n   [:button {:class (+ \"bp3-button\n                     \t\tbp3-small\n                     \t\tbp3-outlined\n                     \t\tbp3-icon-\" icon)\n                    :draggable false\n                    :style {:margin \"10px 5px\"\n                            ;;:float \"right\"\n                            }\n                    :on-click (fn [e](click-fn))}\n           text]])\n\n(defn main [{:keys [block-uid]} & args]\n  ;;this is a dumb hack to avoid save-highlight triggering when args are passed\n  (swap! app-data assoc-in [:parent] block-uid)\n  \t[:body.highlight-review\n      [:div.highlight-card.highlight {:class \"bp3-card bp3-elevation-2\" \n             :style{:max-width \"500px\" \n                    :background-color \"rgb(244,243,243)\" \n                    :padding \"0px\"\n                    }}\n       [card (:book @app-data) (:highlight @app-data)]\n       [footer-button \"save\" \"export\" save-highlight  ]\n       [footer-button \"another\" \"refresh\" get-highlight]\n\n     ]]\n  )\n```","uid":"KgZGnfMTi","create-time":1645898804661,"edit-time":1645905639082,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"4KQjx2foE","edit-time":1645903755968,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"CSS (Optional)","create-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"__ Move these CSS codeblocks to your __[[roam/css]]__ page__","create-time":1645898467894,":block/refs":[{":block/uid":"xX3DhaC1m"}],"refs":[{"uid":"xX3DhaC1m"}],":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"uid":"i-IqensAU","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}},{"string":"Component Styling","create-time":1645898467894,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"children":[{"string":"```css\n.highlight-review{\n  /* the main UI card */\n}```","uid":"CPRA8P4mw","create-time":1645898467894,"edit-time":1645905661138,":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"mYlBiCME8","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"HPZQkIVOc","edit-time":1645898467894,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"refs":[{"uid":"09-21-2021"}],"uid":"vIt4QR5ME",":block/refs":[{":block/uid":"09-21-2021"}],"string":"Highlight Review v5 [[September 21st, 2021]]",":create/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"},"create-time":1645898466261,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}],"uid":"VK3JN0EgW","edit-time":1629371007672,":edit/user":{":user/uid":"rTvmoxu9FGSWal8SbCZiywCL2Nm1"}}]